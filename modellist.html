<!DOCTYPE html>
<html>
<head>
<style type="text/css">
.active {color: #32CD32; }
.overdue {color: #ff0000; }
</style>
<script src="http://yui.yahooapis.com/3.17.2/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">
<script>
// Create a new YUI instance and populate it with the required modules.
YUI().use(['model-list', 'datatable'], function (Y) {

    var responseText = {"item_loans": {"item_loan": {"loanId":"619636060002021","loanStatus":"Active","dueDate":"2014-06-27 23:59:00","processStatus":"Renew","description": {},"locationCode":"MAIN_BK","itemBarcode":"2100995741","title":"UNIX programming environment \/ Brian W. Kernighan, Rob Pike.","author":"Kernighan, Brian W. (Brian Wilson)","callNumber":"QA76.6 K31","loanDate":"2013-06-28 15:42:06","locationName":"Main collection books","itemPolicy":"NORMAL","loanFine":"0.0"}}};

    Y.AlmaLoanItem = Y.Base.create('almaLoanItem', Y.Model, [], {
        // methods
    }, {
        ATTRS: {
            loanId : {},
            loanStatus : {},
            dueDate : {},
            processStatus : {},
            description : {},
            locationCode : {},
            itemBarCode : {},
            title : {},
            author : {},
            callNumber : {},
            loanDate : {},
            locationName : {},
            itemPolicy : {},
            loanFine : {}
        }
    });

    Y.AlmaLoanItemsList = Y.Base.create('almaLoanItemsList', Y.ModelList, [], {

        model : Y.AlmaLoanItem,

        sync: function (action, options, callback) {

            if (action == 'read') { // Currently the default action
                data = responseText; // Get from Y.io..
                callback(null, data);
            }
        },
        parse : function (response) {
            if (response) {
                return (Array(response.item_loans.item_loan));
            }
            this.fire('error', {
                type : 'parse',
                error : 'No data in the response'
            });
        }
    });

    var table = new Y.DataTable({
        recordType: Y.AlmaLoanItem,
        columns : [
            {
                key : 'title',
                label : 'Title'
            },
            {
                key :'dueDate',
                label : 'Due',
                formatter : function(o) {
                    switch (o.data.loanStatus) {
                        case 'Active' :
                            o.className += 'active';
                            break;
                        case 'Overdue' :
                            o.className += 'overdue';
                            break;
                    }
                }
            }
        ],
        data: new Y.AlmaLoanItemsList(),
        caption: "Your loans",
        summary: "Table showing items you have on loan from the library",
        sortable: true
    });
    table.data.load(function() {
        table.render("#almaloans");
    });
});
</script>
</body>
</html>

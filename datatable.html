<!DOCTYPE html>
<html>
<script src="http://yui.yahooapis.com/3.17.2/build/yui/yui-min.js"></script>
<body class="yui3-skin-sam">
<script>
// Create a new YUI instance and populate it with the required modules.
YUI().use(["datatable", "datasource-get", "datasource-jsonschema", "datatable-datasource"], function (Y) {

    var responseText = {"item_loans": [{"item_loan": {"loanId":"619636060002021","loanStatus":"Active","dueDate":"2014-06-27 23:59:00","processStatus":"Renew","description": {},"locationCode":"MAIN_BK","itemBarcode":"2100995741","title":"UNIX programming environment \/ Brian W. Kernighan, Rob Pike.","author":"Kernighan, Brian W. (Brian Wilson)","callNumber":"QA76.6 K31","loanDate":"2013-06-28 15:42:06","locationName":"Main collection books","itemPolicy":"NORMAL","loanFine":"0.0"}}]};


    var localDataSource = new Y.DataSource.Local({source:responseText});

    localDataSource.plug(Y.Plugin.DataSourceJSONSchema, {
        schema: {
            resultListLocator: 'item_loans',
            resultFields : [
                { key : 'title', locator: 'item_loan.title'},
                { key : 'dueDate', locator: 'item_loan.dueDate'}
            ]
        },
    });
/*    localDataSource.sendRequest({
        callback: {
            success: function(e) {
                Y.log(e);
            }
        }
    });

*/
/*
    Y.AlmaLoanItemModel = Y.Base.create('almaLoanItemModel', Y.Model, [], {
        // methods
    }, {
        ATTRS: {
            loanId : {},
            loanStatus : {},
            dueDate : {},
            processStatus : {},
            description : {},
            locationCode : {},
            itemBarCode : {},
            title : {},
            author : {},
            callNumber : {},
            loanDate : {},
            locationName : {},
            itemPolicy : {},
            loanFine : {}
        }
    });

    Y.AlmaLoanItemsList = Y.Base.create('almaLoanItemsList', Y.ModelList, [], {

            sync: function (action, options, callback) {
                Y.log("action: " + action + ", options: " + options + ", callback: " + callback);

                var data;

                var responseText = {"item_loans": {"item_loan": {"loanId":"619636060002021","loanStatus":"Active","dueDate":"2014-06-27 23:59:00","processStatus":"Renew","description": {},"locationCode":"MAIN_BK","itemBarcode":"2100995741","title":"UNIX programming environment \/ Brian W. Kernighan, Rob Pike.","author":"Kernighan, Brian W. (Brian Wilson)","callNumber":"QA76.6 K31","loanDate":"2013-06-28 15:42:06","locationName":"Main collection books","itemPolicy":"NORMAL","loanFine":"0.0"}}};

                if (action == 'read') {
                    // Other values are not currently supported,
                    // but may be added in a future release.
                    data = responseText; // get from Y.io
                    callback(null, data);
                }
            },
            parse : function (response) {
                Y.log("response received to parse: " + response);

                if (response.data) {
                    return Y.JSON.parse(response.data);
                }

                this.fire('error', {
                    type : 'parse',
                    error : 'No data in the response'
                });
            }

        }, {
        model: Y.AlmaLoanItemModel,
    });

/*    var loanItems = new Y.AlmaLoanItemsList();
    var response = Y.JSON.parse(responseText);
    for (var i in response.item_loans) {
        loanItems.add(response.item_loans[i]);
    }
*/
    var table = new Y.DataTable({
        columns : [
            {
                key : 'title',
                label : 'Title'
            },
            {
                key :'dueDate',
                label : 'Due'
            }
        ],
/*
        recordType: {
            title: {},
            dueDate: {}
        },
*/
        //data: new Y.AlmaLoanItemsList(),
        // Optionally configure your table with a caption
        caption: "Your loans",

        // and/or a summary (table attribute)
        summary: "Table showing items you have on loan from the library"
    });

    table.render("#example");

    table.plug(Y.Plugin.DataTableDataSource, {
        datasource: localDataSource,
    });

    table.datasource.load({
        callback: {
            success: function (e) {
                table.datasource.onDataReturnInitializeTable(e);
            }
        },
        on: {
            failure : function(e) {
                Y.log(e.error.message);
            },
            success: function (e) {
                Y.log(e.response);
            }
        }
    });


});
</script>
</body>
</html>
